{% load cache comment_tags markup_tags gravatar smart_if %}
{% cache 1000000 comments object.pk %}

<h5><a name="comments">Comments</a></h5>
{% get_comment_list for object as comment_list %}
<p><a href="#commentform">Leave a comment</a></p>

<div id="comments_div">
	<ol id="commentList" class="comments">
{% for comment in comment_list %}
		<li class="comment {% if comment.user.is_staff %}isauthor{% endif %}">
		<a name="c{{ comment.shortid }}"></a>
		<div class="author vcard">
			<a class="url" {% if comment.url %}href="{{ comment.url }}"{% endif %}>
				{% if comment.user_type == 'facebook' %}
					<span class="gravatar">
					<fb:profile-pic uid="{{ comment.facebook_uid }}" facebook-logo="true"/>
					</span>
				{% else %}
					{% gravatar_img_for_email comment.email 50 %}
				{% endif %}
			</a>
			<cite class="fn">
				<a class="fn url {{ comment.user_type }}" 
					{% if comment.url %}href="{{ comment.url }}" rel="nofollow"{% endif %}>
				{{ comment.name }}</a>
			</cite>
			<abbr title="{{ comment.submit_date }}">
				{{ comment.submit_date|date:'Y-m-d h:iA' }}
			</abbr>
		</div>
		<div class="content">
			<p>{{ comment.comment|force_escape|render:'Markdown' }}</p>
		</div>
		</li>
{% endfor %}
	</ol>
</div>

{% endcache %}